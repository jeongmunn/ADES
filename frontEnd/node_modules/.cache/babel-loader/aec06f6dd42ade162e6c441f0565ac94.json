{"ast":null,"code":"import _classCallCheck from\"C:/Users/khadi/OneDrive/Documents/GitHub/ADES/frontEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/khadi/OneDrive/Documents/GitHub/ADES/frontEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/khadi/OneDrive/Documents/GitHub/ADES/frontEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/khadi/OneDrive/Documents/GitHub/ADES/frontEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import axios from'axios';import{store}from'react-notifications-component';import{getStorage,ref,uploadBytes,getDownloadURL}from'firebase/storage';import{signOut}from\"firebase/auth\";import{auth}from'../firebase.js';import Button from'react-bootstrap/Button';import Accordion from'react-bootstrap/Accordion';import Table from'react-bootstrap/Table';import Form from'react-bootstrap/Form';import{Row,Col}from'react-bootstrap';import ModalPopup from'./RewardPopup';import'../css/rewardAdmin.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var viewReward=/*#__PURE__*/function(_React$Component){_inherits(viewReward,_React$Component);var _super=_createSuper(viewReward);function viewReward(){var _this;_classCallCheck(this,viewReward);_this=_super.call(this);_this.isShowPopup=function(status,id,name,points,url){_this.setState({showModalPopup:status});_this.setState({rewardID:id});_this.setState({originName:name});_this.setState({originPoints:points});_this.setState({originUrl:url});};_this.handleDelete=function(event){var id=event.target.id;axios.delete('https://ades-ca1-project.herokuapp.com/api/rewards/'+id).then(function(res){window.alert(\"Reward deleted successfully\");window.location.reload();});};_this.handleName=function(event){_this.setState({rewardName:event.target.value});};_this.handlePoints=function(event){_this.setState({rewardPoints:event.target.value});};_this.handleURL=function(event){_this.setState({url:event.target.files[0]});};_this.handleSubmit=function(event){event.preventDefault();if(_this.state.url==''){var reward={rewardName:_this.state.rewardName,ptsRequired:_this.state.rewardPoints,url:'https://firebasestorage.googleapis.com/v0/b/quizment-ae4a6.appspot.com/o/img%2Fdefault-image.png?alt=media&token=369e00f7-926d-4b3c-abbb-958828b303d5'};console.log(\"reward\"+JSON.stringify(reward));var config={headers:{'content-type':'application/json'}};axios.post('https://ades-ca1-project.herokuapp.com/api/rewards',reward,config).then(function(res){console.log(res);console.log(res.data);window.location.reload();_this.notiUploadSuccess();});}else{// file upload\n// packing data    \nvar storage=getStorage();var storageRef=ref(storage,'img/'+_this.state.url.name);var file=_this.state.url;// Create file metadata including the content type\n/** @type {any} */var metadata={contentType:_this.state.url.type};uploadBytes(storageRef,file,metadata);getDownloadURL(storageRef).then(function(downloadURL){console.log('File available at',downloadURL);var reward={rewardName:_this.state.rewardName,ptsRequired:_this.state.rewardPoints,url:downloadURL};console.log(\"reward\"+JSON.stringify(reward));var config={headers:{'content-type':'application/json'}};axios.post('https://ades-ca1-project.herokuapp.com/api/rewards',reward,config).then(function(res){console.log(res);console.log(res.data);window.location.reload();_this.notiUploadSuccess();});});}};_this.state={showModalPopup:false,data:[],rewardName:'',rewardPoints:'',originUrl:'',originName:'',originPoints:'',url:'',rewardID:0,uid:''};return _this;}_createClass(viewReward,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;// Auth\nauth.onAuthStateChanged(function(user){// IF there's user\nif(user){console.log(\"User is Signed IN \");_this2.setState({uid:user.uid});var config={headers:{'content-type':'application/json'}};// Get the user type\naxios.get(\"https://ades-ca1-project.herokuapp.com/api/userType/\"+_this2.state.uid,config).then(function(res){// IF is student\nif(res.data.type===1){window.location.replace('https://ades-ca1-project.herokuapp.com/quizment/studentDashboard');// IF is teacher\n}else if(res.data.type===2){// GET all rewards data\naxios.get('https://ades-ca1-project.herokuapp.com/api/rewards').then(function(res){_this2.setState({data:res.data});});// ELSE kick them out\n}else{window.location.replace('https://ades-ca1-project.herokuapp.com/quizment');}});// ELSE kick them out\n}else{console.log(\"THERE IS NO USER\");signOut(auth);window.location.replace('https://ades-ca1-project.herokuapp.com/quizment');}});}},{key:\"notiUploadSuccess\",value:function notiUploadSuccess(){store.addNotification({title:\"Success\",message:\"Reward uploaded successfully !\",type:\"success\",insert:\"top\",container:\"top-center\",animationIn:[\"animated\",\"fadeIn\"],animationOut:[\"animated\",\"fadeOut\"],dismiss:{duration:2000},dismissable:{click:true}});}},{key:\"render\",value:function render(){var _this3=this;var data=this.state.data;return/*#__PURE__*/_jsxs(\"div\",{className:\"rewardAdmin\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Reward Administration\"}),/*#__PURE__*/_jsx(Accordion,{children:/*#__PURE__*/_jsxs(Accordion.Item,{eventKey:\"0\",children:[/*#__PURE__*/_jsx(Accordion.Header,{children:/*#__PURE__*/_jsx(Button,{variant:\"outline-info\",children:\"Add Reward\"})}),/*#__PURE__*/_jsx(Accordion.Body,{children:/*#__PURE__*/_jsx(\"div\",{className:\"uploadReward\",children:/*#__PURE__*/_jsx(Form,{onSubmit:this.handleSubmit,className:\"rewardForm\",children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{xs:12,md:8,lg:4,children:/*#__PURE__*/_jsx(Form.Control,{placeholder:\"Reward Name\",onChange:this.handleName,required:true})}),/*#__PURE__*/_jsx(Col,{xs:12,md:5,lg:3,children:/*#__PURE__*/_jsx(Form.Control,{type:\"number\",placeholder:\"Points Required\",onChange:this.handlePoints,required:true})}),/*#__PURE__*/_jsx(Col,{xs:12,md:5,lg:3,children:/*#__PURE__*/_jsx(Form.Control,{type:\"file\",onChange:this.handleURL})}),/*#__PURE__*/_jsx(Col,{xs:12,md:2,lg:2,children:/*#__PURE__*/_jsx(Button,{variant:\"primary\",type:\"submit\",children:\"Add\"})})]})})})})]})}),/*#__PURE__*/_jsx(\"div\",{id:\"viewRewards\",children:/*#__PURE__*/_jsxs(Table,{responsive:\"sm\",className:\"table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Points\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Picture\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Edit?\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Delete?\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:data&&data.map(function(item){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:item.rewardName}),/*#__PURE__*/_jsx(\"td\",{children:item.ptsRequired}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"img\",{src:item.url,style:{height:180,width:180}})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"warning\",onClick:function onClick(){return _this3.isShowPopup(true,item.rewardID,item.rewardName,item.ptsRequired,item.url);},children:\"Edit\"})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"danger\",id:item.rewardID,onClick:_this3.handleDelete,children:\"Delete\"})})]},item.rewardID);})})]})}),/*#__PURE__*/_jsx(ModalPopup,{showModalPopup:this.state.showModalPopup,onPopupClose:this.isShowPopup,rewardID:this.state.rewardID,rewardName:this.state.originName,rewardPoints:this.state.originPoints,url:this.state.originUrl})]});}}]);return viewReward;}(React.Component);export{viewReward as default};","map":{"version":3,"sources":["C:/Users/khadi/OneDrive/Documents/GitHub/ADES/frontEnd/src/components/RewardAdmin.js"],"names":["React","axios","store","getStorage","ref","uploadBytes","getDownloadURL","signOut","auth","Button","Accordion","Table","Form","Row","Col","ModalPopup","viewReward","isShowPopup","status","id","name","points","url","setState","showModalPopup","rewardID","originName","originPoints","originUrl","handleDelete","event","target","delete","then","res","window","alert","location","reload","handleName","rewardName","value","handlePoints","rewardPoints","handleURL","files","handleSubmit","preventDefault","state","reward","ptsRequired","console","log","JSON","stringify","config","headers","post","data","notiUploadSuccess","storage","storageRef","file","metadata","contentType","type","downloadURL","uid","onAuthStateChanged","user","get","replace","addNotification","title","message","insert","container","animationIn","animationOut","dismiss","duration","dismissable","click","map","item","height","width","Component"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport axios from 'axios';\r\nimport { store } from 'react-notifications-component';\r\nimport { getStorage, ref, uploadBytes, getDownloadURL } from 'firebase/storage';\r\nimport { signOut } from \"firebase/auth\";\r\nimport { auth } from '../firebase.js';\r\nimport Button from 'react-bootstrap/Button';\r\nimport Accordion from 'react-bootstrap/Accordion';\r\nimport Table from 'react-bootstrap/Table';\r\nimport Form from 'react-bootstrap/Form';\r\nimport { Row, Col } from 'react-bootstrap';\r\nimport ModalPopup from './RewardPopup';\r\nimport '../css/rewardAdmin.css';\r\n\r\nexport default class viewReward extends React.Component {\r\n    constructor() {\r\n        super();\r\n        this.state = {\r\n            showModalPopup: false,\r\n            data: [],\r\n            rewardName: '',\r\n            rewardPoints: '',\r\n            originUrl: '',\r\n            originName: '',\r\n            originPoints: '',\r\n            url: '',\r\n            rewardID: 0,\r\n            uid: ''\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        // Auth\r\n        auth.onAuthStateChanged((user) => {\r\n            // IF there's user\r\n            if (user) {\r\n                console.log(\"User is Signed IN \");\r\n                this.setState({ uid: user.uid });\r\n                const config = {\r\n                    headers: {\r\n                        'content-type': 'application/json'\r\n                    }\r\n                }\r\n\r\n                // Get the user type\r\n                axios.get(`https://ades-ca1-project.herokuapp.com/api/userType/` + this.state.uid, config)\r\n                    .then(res => {\r\n                        // IF is student\r\n                        if (res.data.type === 1) {\r\n                            window.location.replace('https://ades-ca1-project.herokuapp.com/quizment/studentDashboard');\r\n                            // IF is teacher\r\n                        } else if (res.data.type === 2) {\r\n                            // GET all rewards data\r\n                            axios.get('https://ades-ca1-project.herokuapp.com/api/rewards')\r\n                                .then(res => {\r\n                                    this.setState({ data: res.data });\r\n                                })\r\n                            // ELSE kick them out\r\n                        } else {\r\n                            window.location.replace('https://ades-ca1-project.herokuapp.com/quizment');\r\n                        }\r\n                    })\r\n                // ELSE kick them out\r\n            } else {\r\n                console.log(\"THERE IS NO USER\");\r\n                signOut(auth);\r\n                window.location.replace('https://ades-ca1-project.herokuapp.com/quizment');\r\n            }\r\n        });\r\n    }\r\n\r\n    notiUploadSuccess() {\r\n        store.addNotification({\r\n            title: \"Success\",\r\n            message: \"Reward uploaded successfully !\",\r\n            type: \"success\",\r\n            insert: \"top\",\r\n            container: \"top-center\",\r\n            animationIn: [\"animated\", \"fadeIn\"],\r\n            animationOut: [\"animated\", \"fadeOut\"],\r\n            dismiss: { duration: 2000 },\r\n            dismissable: { click: true }\r\n        });\r\n    }\r\n\r\n    isShowPopup = (status, id, name, points, url) => {\r\n        this.setState({ showModalPopup: status });\r\n        this.setState({ rewardID: id });\r\n        this.setState({ originName: name });\r\n        this.setState({ originPoints: points });\r\n        this.setState({ originUrl: url });\r\n    }\r\n\r\n    handleDelete = event => {\r\n        const id = event.target.id;\r\n        axios.delete('https://ades-ca1-project.herokuapp.com/api/rewards/' + id)\r\n            .then(res => {\r\n                window.alert(\"Reward deleted successfully\");\r\n                window.location.reload();\r\n            })\r\n    }\r\n\r\n    handleName = event => {\r\n        this.setState({ rewardName: event.target.value });\r\n    }\r\n\r\n    handlePoints = event => {\r\n        this.setState({ rewardPoints: event.target.value });\r\n    }\r\n\r\n    handleURL = event => {\r\n        this.setState({ url: event.target.files[0], });\r\n    }\r\n\r\n    handleSubmit = event => {\r\n        event.preventDefault();\r\n        if (this.state.url == '') {\r\n            const reward = {\r\n                rewardName: this.state.rewardName,\r\n                ptsRequired: this.state.rewardPoints,\r\n                url: 'https://firebasestorage.googleapis.com/v0/b/quizment-ae4a6.appspot.com/o/img%2Fdefault-image.png?alt=media&token=369e00f7-926d-4b3c-abbb-958828b303d5'\r\n            };\r\n            console.log(\"reward\" + JSON.stringify(reward));\r\n\r\n            const config = {\r\n                headers: {\r\n                    'content-type': 'application/json'\r\n                }\r\n            }\r\n\r\n            axios.post('https://ades-ca1-project.herokuapp.com/api/rewards', reward, config)\r\n                .then(res => {\r\n                    console.log(res);\r\n                    console.log(res.data);\r\n                    window.location.reload();\r\n                    this.notiUploadSuccess();\r\n                })\r\n        } else {\r\n            // file upload\r\n            // packing data    \r\n            const storage = getStorage();\r\n            const storageRef = ref(storage, 'img/' + this.state.url.name);\r\n            var file = this.state.url;\r\n            // Create file metadata including the content type\r\n            /** @type {any} */\r\n            const metadata = {\r\n                contentType: this.state.url.type,\r\n            };\r\n            uploadBytes(storageRef, file, metadata);\r\n\r\n            getDownloadURL(storageRef).then((downloadURL) => {\r\n                console.log('File available at', downloadURL);\r\n\r\n                const reward = {\r\n                    rewardName: this.state.rewardName,\r\n                    ptsRequired: this.state.rewardPoints,\r\n                    url: downloadURL\r\n                };\r\n                console.log(\"reward\" + JSON.stringify(reward))\r\n                const config = {\r\n                    headers: {\r\n                        'content-type': 'application/json'\r\n                    }\r\n                }\r\n\r\n                axios.post('https://ades-ca1-project.herokuapp.com/api/rewards', reward, config)\r\n                    .then(res => {\r\n                        console.log(res);\r\n                        console.log(res.data);\r\n                        window.location.reload();\r\n                        this.notiUploadSuccess();\r\n                    })\r\n            })\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const data = this.state.data;\r\n        return (\r\n            <div className=\"rewardAdmin\">\r\n                <h1>Reward Administration</h1>\r\n                <Accordion>\r\n                    <Accordion.Item eventKey=\"0\">\r\n                        <Accordion.Header>\r\n                            <Button variant=\"outline-info\" >Add Reward</Button>\r\n                        </Accordion.Header>\r\n                        <Accordion.Body>\r\n                            <div className=\"uploadReward\">\r\n                                <Form onSubmit={this.handleSubmit} className=\"rewardForm\">\r\n                                    <Row>\r\n                                        <Col xs={12} md={8} lg={4}>\r\n                                            <Form.Control placeholder=\"Reward Name\" onChange={this.handleName} required />\r\n                                        </Col>\r\n                                        <Col xs={12} md={5} lg={3}>\r\n                                            <Form.Control type=\"number\" placeholder=\"Points Required\" onChange={this.handlePoints} required />\r\n                                        </Col>\r\n                                        <Col xs={12} md={5} lg={3}>\r\n                                            <Form.Control type=\"file\" onChange={this.handleURL} />\r\n                                        </Col>\r\n                                        <Col xs={12} md={2} lg={2}>\r\n                                            <Button variant=\"primary\" type=\"submit\">Add</Button>\r\n                                        </Col>\r\n                                    </Row>\r\n                                </Form>\r\n                            </div>\r\n                        </Accordion.Body>\r\n                    </Accordion.Item>\r\n                </Accordion>\r\n                <div id=\"viewRewards\">\r\n                    <Table responsive=\"sm\" className=\"table\">\r\n                        <thead>\r\n                            <tr>\r\n                                <th>Name</th>\r\n                                <th>Points</th>\r\n                                <th>Picture</th>\r\n                                <th>Edit?</th>\r\n                                <th>Delete?</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {data && data.map(item =>\r\n                                <tr key={item.rewardID}>\r\n                                    <td>{item.rewardName}</td>\r\n                                    <td>{item.ptsRequired}</td>\r\n                                    <td><img src={item.url} style={{ height: 180, width: 180 }}></img></td>\r\n                                    <td><Button type=\"button\" variant=\"warning\" onClick={() => this.isShowPopup(true, item.rewardID, item.rewardName, item.ptsRequired, item.url)}>Edit</Button></td>\r\n                                    <td><Button type=\"button\" variant=\"danger\" id={item.rewardID} onClick={this.handleDelete}>Delete</Button></td>\r\n                                </tr>\r\n                            )}\r\n                        </tbody>\r\n                    </Table>\r\n                </div>\r\n                <ModalPopup\r\n                    showModalPopup={this.state.showModalPopup}\r\n                    onPopupClose={this.isShowPopup}\r\n                    rewardID={this.state.rewardID}\r\n                    rewardName={this.state.originName}\r\n                    rewardPoints={this.state.originPoints}\r\n                    url={this.state.originUrl}\r\n                ></ModalPopup>\r\n            </div>\r\n        )\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}